# Feature Specification: Task Display Mode Redesign

**Feature Branch**: `003-task-display`
**Created**: 2025-02-13
**Status**: Draft
**Input**: User description: "æ•´ä½“ä¿®æ”¹å½“å‰ä»»åŠ¡çš„æ˜¾ç¤ºæ¨¡å¼,åŒ…æ‹¬ä¸‰ç§åœºæ™¯:å¿«é€Ÿå›ç­”,è°ƒç”¨ä¸“æœ‰agent,è‡ªä¸»è§„åˆ’æ¨¡å¼çš„å‰ç«¯æ˜¾ç¤º,è®¾è®¡SSEäº‹ä»¶,æ”¹æˆä¸‰å±‚æ˜¾ç¤ºé€»è¾‘:thinking bob:åªå±•ç¤ºè§„åˆ’é˜¶æ®µå’Œé‡è§„åˆ’,æ€è€ƒçš„è¿‡ç¨‹;æ‰§è¡Œå±•ç¤ºä½¿ç”¨æ ‘çŠ¶ç»“æ„,ç¬¬ä¸€å±‚æ˜¯ä»»åŠ¡,ä¸“æœ‰agentæ˜¯ä¸€ä¸ªä»»åŠ¡;ä»»åŠ¡ä¸‹è¯¦ç»†å±•ç¤ºæ‰§è¡Œè¿‡ç¨‹,æ¯”å¦‚tool calling;æœ€åæ˜¯ç»“æœæ˜¾ç¤ºåŒºåŸŸ"

## Clarifications

### Session 2025-02-13

- Q: How should the frontend handle SSE reconnection after network interruption? â†’ A: Auto-reconnect silently, resume from last event (using event ID tracking)

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Quick Answer Display (Priority: P1)

ç”¨æˆ·æå‡ºç®€å•é—®é¢˜æ—¶ï¼Œç³»ç»Ÿç›´æ¥ç»™å‡ºç­”æ¡ˆï¼Œæ— éœ€æ˜¾ç¤ºå¤æ‚çš„æ‰§è¡Œè¿‡ç¨‹ã€‚

**Why this priority**: è¿™æ˜¯æœ€å¸¸è§çš„ç”¨æˆ·åœºæ™¯ï¼Œçº¦ 60-70% çš„äº¤äº’å±äºæ­¤ç±»å‹ã€‚å¿«é€Ÿå“åº”ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒã€‚

**Independent Test**: å¯é€šè¿‡å‘é€ç®€å•é—®å€™æˆ–é—®é¢˜ï¼ˆå¦‚"ä½ å¥½"ã€"ä»Šå¤©æ˜ŸæœŸå‡ "ï¼‰ç‹¬ç«‹æµ‹è¯•ï¼Œç”¨æˆ·åº”çœ‹åˆ°ç®€æ´çš„å›ç­”ï¼Œæ— é¢å¤–çš„æ€è€ƒæˆ–æ‰§è¡Œå±‚çº§å±•ç¤ºã€‚

**Acceptance Scenarios**:

1. **Given** ç”¨æˆ·å‘é€ç®€å•é—®å€™"ä½ å¥½", **When** ç³»ç»Ÿè¯†åˆ«ä¸ºå¿«é€Ÿå›ç­”åœºæ™¯, **Then** ç”¨æˆ·åªçœ‹åˆ°ç»“æœåŒºåŸŸæ˜¾ç¤ºå›ç­”å†…å®¹ï¼Œæ— æ€è€ƒæ°”æ³¡æˆ–ä»»åŠ¡æ ‘
2. **Given** ç”¨æˆ·è¯¢é—®ç®€å•äº‹å®é—®é¢˜, **When** ç³»ç»Ÿæ— éœ€è°ƒç”¨å·¥å…·å³å¯å›ç­”, **Then** å“åº”åœ¨ 2 ç§’å†…å®Œæˆæ˜¾ç¤ºï¼Œç•Œé¢ä¿æŒç®€æ´
3. **Given** æ­£åœ¨æ˜¾ç¤ºå¿«é€Ÿå›ç­”, **When** å›ç­”æµå¼è¾“å‡ºä¸­, **Then** ç”¨æˆ·çœ‹åˆ°æ‰“å­—æœºæ•ˆæœçš„æ–‡å­—é€æ­¥æ˜¾ç¤º

---

### User Story 2 - Specialized Agent Execution Display (Priority: P1)

ç”¨æˆ·è¯·æ±‚ç‰¹å®šé¢†åŸŸä»»åŠ¡ï¼ˆå¦‚ SQL æŸ¥è¯¢ã€ç½‘ç»œæœç´¢ï¼‰ï¼Œç³»ç»Ÿè°ƒç”¨ä¸“æœ‰ Agentï¼Œä»»åŠ¡æ ‘æ˜¾ç¤ºè¯¥ Agent ä½œä¸ºå•ä¸€ä»»åŠ¡èŠ‚ç‚¹ï¼Œå¯å±•å¼€æŸ¥çœ‹æ‰§è¡Œè¯¦æƒ…ã€‚

**Why this priority**: ä¸“æœ‰ Agent è°ƒç”¨æ˜¯æ ¸å¿ƒåŠŸèƒ½ï¼Œç”¨æˆ·éœ€è¦æ¸…æ™°çœ‹åˆ°å·¥å…·è°ƒç”¨çš„è¿‡ç¨‹å’Œç»“æœï¼Œä¾¿äºç†è§£å’Œè°ƒè¯•ã€‚

**Independent Test**: å¯é€šè¿‡å‘é€"/sql åˆ—å‡ºæ‰€æœ‰è¡¨"ç‹¬ç«‹æµ‹è¯•ï¼Œç”¨æˆ·åº”çœ‹åˆ°ä»»åŠ¡æ ‘å±•ç¤º SQL Agent ä½œä¸ºä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹ï¼Œç‚¹å‡»å±•å¼€å¯æŸ¥çœ‹å·¥å…·è°ƒç”¨è¯¦æƒ…ã€‚

**Acceptance Scenarios**:

1. **Given** ç”¨æˆ·å‘é€ "/sql å“ªä¸ªè‰ºæœ¯å®¶ä¸“è¾‘æœ€å¤š", **When** ç³»ç»Ÿè·¯ç”±åˆ° SQL Agent, **Then** ä»»åŠ¡æ ‘æ˜¾ç¤ºä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹"SQL Agent"ï¼Œé»˜è®¤æŠ˜å çŠ¶æ€
2. **Given** ä»»åŠ¡èŠ‚ç‚¹å¤„äºæŠ˜å çŠ¶æ€, **When** ç”¨æˆ·ç‚¹å‡»å±•å¼€, **Then** æ˜¾ç¤ºè¯¥ä»»åŠ¡å†…éƒ¨çš„æ‰§è¡Œè¿‡ç¨‹ï¼štool calling äº‹ä»¶åˆ—è¡¨
3. **Given** SQL Agent æ­£åœ¨æ‰§è¡Œ, **When** `sql_db_list_tables` å·¥å…·è¢«è°ƒç”¨, **Then** å±•å¼€åçš„æ‰§è¡Œè¯¦æƒ…ä¸­å®æ—¶æ˜¾ç¤ºè¯¥å·¥å…·è°ƒç”¨ï¼ŒçŠ¶æ€ä¸º"æ‰§è¡Œä¸­"
4. **Given** å·¥å…·è°ƒç”¨å®Œæˆ, **When** æ”¶åˆ°å·¥å…·ç»“æœ, **Then** å·¥å…·è°ƒç”¨çŠ¶æ€æ›´æ–°ä¸º"å®Œæˆ"ï¼Œæ˜¾ç¤ºè¾“å‡ºæ‘˜è¦
5. **Given** å¤šä¸ªå·¥å…·ä¾æ¬¡è°ƒç”¨, **When** æ¯ä¸ªå·¥å…·å®Œæˆ, **Then** æ‰§è¡Œè¯¦æƒ…å®æ—¶æ›´æ–°ï¼Œæ–°å·¥å…·è¿½åŠ åˆ°åˆ—è¡¨

---

### User Story 3 - Autonomous Planning Mode Display (Priority: P1)

ç”¨æˆ·æå‡ºå¤æ‚ä»»åŠ¡ï¼Œç³»ç»Ÿè‡ªä¸»è§„åˆ’ã€æ‹†åˆ†å­ä»»åŠ¡å¹¶å¹¶è¡Œæ‰§è¡Œï¼Œä»»åŠ¡æ ‘æ˜¾ç¤ºå¤šä¸ªä»»åŠ¡èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯å±•å¼€æŸ¥çœ‹æ‰§è¡Œè¯¦æƒ…ã€‚

**Why this priority**: è‡ªä¸»è§„åˆ’æ¨¡å¼æ˜¯ç³»ç»Ÿæœ€å¼ºå¤§çš„èƒ½åŠ›ï¼Œéœ€è¦æ¸…æ™°å±•ç¤ºè§„åˆ’é€»è¾‘ã€æ‰§è¡Œè¿›åº¦å’Œæœ€ç»ˆç»“æœï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£ AI çš„æ¨ç†è¿‡ç¨‹ã€‚

**Independent Test**: å¯é€šè¿‡å‘é€å¤æ‚ä»»åŠ¡ï¼ˆå¦‚"åˆ†æ AI å‘å±•è¶‹åŠ¿å¹¶å¯¹æ¯”ä¸»è¦ç«äº‰è€…"ï¼‰ç‹¬ç«‹æµ‹è¯•ï¼Œç”¨æˆ·åº”çœ‹åˆ°æ€è€ƒæ°”æ³¡ã€å¤šä¸ªä»»åŠ¡èŠ‚ç‚¹ï¼ˆå¯å±•å¼€ï¼‰ã€å¹¶è¡Œæ‰§è¡ŒçŠ¶æ€å’Œç»¼åˆç»“æœã€‚

**Acceptance Scenarios**:

1. **Given** ç”¨æˆ·å‘é€å¤æ‚ä»»åŠ¡"æ¯”è¾ƒä¸‰å®¶å…¬å¸çš„å¸‚åœºç­–ç•¥", **When** ç³»ç»Ÿè¿›å…¥è‡ªä¸»è§„åˆ’æ¨¡å¼, **Then** æ€è€ƒåŒºæ˜¾ç¤ºè§„åˆ’è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ä»»åŠ¡æ‹†åˆ†é€»è¾‘
2. **Given** è§„åˆ’å®Œæˆäº§ç”Ÿ 3 ä¸ªå­ä»»åŠ¡, **When** ç³»ç»Ÿå¼€å§‹æ‰§è¡Œ, **Then** ä»»åŠ¡æ ‘æ˜¾ç¤º 3 ä¸ªä»»åŠ¡èŠ‚ç‚¹ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰ï¼Œæ¯ä¸ªä»»åŠ¡æœ‰çŠ¶æ€æŒ‡ç¤ºå™¨ï¼Œé»˜è®¤æŠ˜å 
3. **Given** å­ä»»åŠ¡æ­£åœ¨å¹¶è¡Œæ‰§è¡Œ, **When** ä»»åŠ¡ A å®Œæˆè€Œä»»åŠ¡ B ä»åœ¨æ‰§è¡Œ, **Then** ä»»åŠ¡ A èŠ‚ç‚¹æ˜¾ç¤ºä¸º"å®Œæˆ"ï¼ˆç»¿è‰²ï¼‰ï¼Œä»»åŠ¡ B èŠ‚ç‚¹æ˜¾ç¤ºä¸º"æ‰§è¡Œä¸­"ï¼ˆåŠ¨ç”»ï¼‰
4. **Given** ç”¨æˆ·ç‚¹å‡»æŸä¸ªä»»åŠ¡èŠ‚ç‚¹å±•å¼€, **When** è¯¥ä»»åŠ¡æ­£åœ¨æ‰§è¡Œ, **Then** æ˜¾ç¤ºè¯¥ä»»åŠ¡å†…éƒ¨çš„ tool calling äº‹ä»¶åˆ—è¡¨ï¼Œå®æ—¶æ›´æ–°
5. **Given** æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç°éœ€è¦é‡æ–°è§„åˆ’, **When** ç³»ç»Ÿå†³å®šå¢åŠ æ–°å­ä»»åŠ¡, **Then** æ€è€ƒåŒºæ–°å¢é‡è§„åˆ’è¯´æ˜ï¼Œä»»åŠ¡æ ‘åŠ¨æ€æ·»åŠ æ–°ä»»åŠ¡èŠ‚ç‚¹
6. **Given** æ‰€æœ‰å­ä»»åŠ¡å®Œæˆ, **When** ç³»ç»Ÿåˆæˆæœ€ç»ˆç»“æœ, **Then** ç»“æœåŒºæ˜¾ç¤ºç»¼åˆå›ç­”ï¼Œä»»åŠ¡æ ‘å…¨éƒ¨ä»»åŠ¡èŠ‚ç‚¹æ ‡è®°ä¸ºå®Œæˆ

---

### User Story 4 - Task Node Expansion (Priority: P2)

ç”¨æˆ·å¯ä»¥å±•å¼€/æŠ˜å ä»»åŠ¡èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ä»»åŠ¡å†…éƒ¨çš„æ‰§è¡Œè¿‡ç¨‹å’Œå·¥å…·è°ƒç”¨è¯¦æƒ…ã€‚

**Why this priority**: å¢å¼ºç”¨æˆ·å¯¹æ‰§è¡Œè¿‡ç¨‹çš„å¯è§æ€§å’Œå¯æ§æ€§ï¼Œä¾¿äºè°ƒè¯•å’Œç†è§£ã€‚

**Independent Test**: å¯åœ¨ä»»ä½•æ˜¾ç¤ºä»»åŠ¡æ ‘çš„åœºæ™¯ä¸‹æµ‹è¯•å±•å¼€/æŠ˜å åŠŸèƒ½ã€‚

**Acceptance Scenarios**:

1. **Given** ä»»åŠ¡æ ‘ä¸­æœ‰ä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹, **When** ç”¨æˆ·ç‚¹å‡»è¯¥èŠ‚ç‚¹, **Then** å±•å¼€æ˜¾ç¤ºè¯¥ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆtool calling äº‹ä»¶åˆ—è¡¨ï¼‰
2. **Given** ä»»åŠ¡å·²å±•å¼€æ˜¾ç¤º tool calling åˆ—è¡¨, **When** ç”¨æˆ·ç‚¹å‡»æŸä¸ªå·¥å…·è°ƒç”¨, **Then** å±•å¼€æ˜¾ç¤ºå®Œæ•´è¾“å…¥å‚æ•°å’Œè¾“å‡ºç»“æœ
3. **Given** å·¥å…·è°ƒç”¨è¾“å‡ºè¾ƒé•¿ï¼ˆè¶…è¿‡ 100 å­—ç¬¦ï¼‰, **When** æ˜¾ç¤ºè¾“å‡º, **Then** é»˜è®¤æ˜¾ç¤ºæ‘˜è¦ï¼Œæä¾›"å±•å¼€å…¨éƒ¨"æŒ‰é’®
4. **Given** ä»»åŠ¡èŠ‚ç‚¹å·²å±•å¼€, **When** ç”¨æˆ·ç‚¹å‡»æŠ˜å æŒ‰é’®, **Then** æŠ˜å å›ä»»åŠ¡èŠ‚ç‚¹ï¼Œåªæ˜¾ç¤ºä»»åŠ¡åå’ŒçŠ¶æ€

---

### User Story 5 - Thinking Bubble Display (Priority: P2)

æ€è€ƒæ°”æ³¡æ¸…æ™°å±•ç¤º AI çš„è§„åˆ’é˜¶æ®µã€é‡è§„åˆ’å†³ç­–å’Œæ¨ç†è¿‡ç¨‹ã€‚

**Why this priority**: å¢å¼ºé€æ˜åº¦ï¼Œè®©ç”¨æˆ·ç†è§£ AI çš„å†³ç­–è¿‡ç¨‹ï¼Œå»ºç«‹ä¿¡ä»»ã€‚

**Independent Test**: å¯åœ¨ä»»ä½•è§¦å‘è§„åˆ’çš„åœºæ™¯ä¸‹è§‚å¯Ÿæ€è€ƒæ°”æ³¡çš„æ˜¾ç¤ºã€‚

**Acceptance Scenarios**:

1. **Given** ç³»ç»Ÿå¼€å§‹å¤„ç†éœ€è¦è§„åˆ’çš„ä»»åŠ¡, **When** è¿›å…¥è§„åˆ’é˜¶æ®µ, **Then** æ€è€ƒæ°”æ³¡æ˜¾ç¤º"æ­£åœ¨åˆ†æä»»åŠ¡..."ï¼Œå¸¦æœ‰åŠ¨ç”»æŒ‡ç¤ºå™¨
2. **Given** è§„åˆ’äº§ç”Ÿå­ä»»åŠ¡åˆ—è¡¨, **When** è§„åˆ’å®Œæˆ, **Then** æ€è€ƒæ°”æ³¡æ˜¾ç¤ºä»»åŠ¡æ‹†åˆ†ç»“æœæ¦‚è¦
3. **Given** æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦é‡è§„åˆ’, **When** ç³»ç»Ÿå†³å®šè°ƒæ•´è®¡åˆ’, **Then** æ€è€ƒæ°”æ³¡æ–°å¢æ¡ç›®æ˜¾ç¤ºé‡è§„åˆ’åŸå› å’Œæ–°è®¡åˆ’

---

### Edge Cases

- **ç½‘ç»œä¸­æ–­**: å½“ SSE è¿æ¥æ–­å¼€æ—¶ï¼Œå‰ç«¯è‡ªåŠ¨é™é»˜é‡è¿ï¼Œä½¿ç”¨äº‹ä»¶ ID è¿½è¸ªä»æ–­ç‚¹æ¢å¤ï¼Œä¿ç•™å·²æ˜¾ç¤ºçš„å†…å®¹ï¼ˆæ— éœ€ç”¨æˆ·å¹²é¢„ï¼‰
- **è¶…é•¿è¾“å‡º**: å·¥å…·è¾“å‡ºè¶…è¿‡ 2000 å­—ç¬¦æ—¶ï¼Œé»˜è®¤æŠ˜å å¹¶æä¾›"å±•å¼€å…¨éƒ¨"æŒ‰é’®
- **ä»»åŠ¡å¤±è´¥**: å•ä¸ªä»»åŠ¡å¤±è´¥æ—¶ï¼Œè¯¥ä»»åŠ¡èŠ‚ç‚¹æ˜¾ç¤ºçº¢è‰²é”™è¯¯çŠ¶æ€ï¼Œä½†å…¶ä»–ä»»åŠ¡ç»§ç»­æ‰§è¡Œ
- **å–æ¶ˆè¯·æ±‚**: ç”¨æˆ·å–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ—¶ï¼Œæ‰€æœ‰è¿›è¡Œä¸­çš„ä»»åŠ¡èŠ‚ç‚¹æ ‡è®°ä¸º"å·²å–æ¶ˆ"
- **ç©ºè§„åˆ’**: å¦‚æœè§„åˆ’é˜¶æ®µæœªäº§ç”Ÿå­ä»»åŠ¡ï¼Œé™çº§ä¸ºå¿«é€Ÿå›ç­”æ¨¡å¼

## Requirements *(mandatory)*

### æ˜¾ç¤ºç»“æ„ç¤ºæ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ€è€ƒåŒº (Thinking Bubble)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ¤” æ­£åœ¨åˆ†æä»»åŠ¡...                                    â”‚   â”‚
â”‚  â”‚ ğŸ“‹ å·²æ‹†åˆ†ä¸º 3 ä¸ªå­ä»»åŠ¡                                â”‚   â”‚
â”‚  â”‚ ğŸ”„ [é‡è§„åˆ’] éœ€è¦å¢åŠ é¢å¤–çš„æ•°æ®æ”¶é›†ä»»åŠ¡                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‰§è¡ŒåŒº (Task Tree) - ä»»åŠ¡èŠ‚ç‚¹åˆ—è¡¨                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â–¶ ä»»åŠ¡1: æœç´¢å…¬å¸Aä¿¡æ¯ [âœ… å®Œæˆ]                      â”‚   â”‚
â”‚  â”‚ â–¼ ä»»åŠ¡2: æœç´¢å…¬å¸Bä¿¡æ¯ [ğŸ”„ æ‰§è¡Œä¸­]  â† å·²å±•å¼€          â”‚   â”‚
â”‚  â”‚   â”œâ”€ ğŸ”§ tavily_search("å…¬å¸B å¸‚åœºç­–ç•¥") [âœ…]          â”‚   â”‚
â”‚  â”‚   â”œâ”€ ğŸ”§ tavily_search("å…¬å¸B ç«äº‰å¯¹æ‰‹") [ğŸ”„ æ‰§è¡Œä¸­]   â”‚   â”‚
â”‚  â”‚   â””â”€ ...                                             â”‚   â”‚
â”‚  â”‚ â–¶ ä»»åŠ¡3: å¯¹æ¯”åˆ†æ [â³ ç­‰å¾…ä¸­]                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç»“æœåŒº (Result Area)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ ¹æ®åˆ†æï¼Œä¸‰å®¶å…¬å¸çš„å¸‚åœºç­–ç•¥å¯¹æ¯”å¦‚ä¸‹...               â”‚   â”‚
â”‚  â”‚ ...                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸“æœ‰ Agent åœºæ™¯ï¼ˆå¦‚ /sqlï¼‰ï¼šä»»åŠ¡æ ‘åªæœ‰ä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹
è‡ªä¸»è§„åˆ’åœºæ™¯ï¼šä»»åŠ¡æ ‘æœ‰å¤šä¸ªä»»åŠ¡èŠ‚ç‚¹
å¿«é€Ÿå›ç­”åœºæ™¯ï¼šéšè—æ€è€ƒåŒºå’Œæ‰§è¡ŒåŒºï¼Œåªæ˜¾ç¤ºç»“æœåŒº
```

### Functional Requirements

**ä¸‰å±‚æ˜¾ç¤ºç»“æ„**

- **FR-001**: ç³»ç»Ÿ MUST æ”¯æŒä¸‰å±‚æ˜¾ç¤ºç»“æ„ï¼šæ€è€ƒåŒºï¼ˆThinking Bubbleï¼‰ã€æ‰§è¡ŒåŒºï¼ˆTask Treeï¼‰ã€ç»“æœåŒºï¼ˆResult Areaï¼‰
- **FR-002**: æ€è€ƒåŒº MUST åªåœ¨è§„åˆ’é˜¶æ®µã€é‡è§„åˆ’é˜¶æ®µæ˜¾ç¤ºå†…å®¹ï¼Œå±•ç¤º AI çš„æ¨ç†è¿‡ç¨‹
- **FR-003**: æ‰§è¡ŒåŒº MUST ä½¿ç”¨ä»»åŠ¡æ ‘å±•ç¤ºæ‰§è¡Œè¿‡ç¨‹ï¼š
  - ä»»åŠ¡æ ‘æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªä»»åŠ¡ä½œä¸ºå¶å­èŠ‚ç‚¹æ˜¾ç¤º
  - ä¸“æœ‰ Agent åœºæ™¯ï¼šä»»åŠ¡æ ‘åªæœ‰ä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹ï¼ˆè¯¥ Agentï¼‰
  - è‡ªä¸»è§„åˆ’åœºæ™¯ï¼šä»»åŠ¡æ ‘æœ‰å¤šä¸ªä»»åŠ¡èŠ‚ç‚¹ï¼ˆè§„åˆ’äº§ç”Ÿçš„å­ä»»åŠ¡ï¼‰
  - æ¯ä¸ªä»»åŠ¡èŠ‚ç‚¹å¯å±•å¼€ï¼Œå±•å¼€åæ˜¾ç¤ºè¯¥ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆtool calling äº‹ä»¶ï¼‰
- **FR-004**: ç»“æœåŒº MUST å±•ç¤ºæœ€ç»ˆçš„æ–‡å­—å›ç­”å’Œç”Ÿæˆçš„æ–‡ä»¶

**SSE äº‹ä»¶è®¾è®¡**

- **FR-005**: åç«¯ MUST å‘é€æ–°çš„ SSE äº‹ä»¶ç±»å‹ä»¥æ”¯æŒä¸‰å±‚æ˜¾ç¤ºï¼ˆè§ä¸‹æ–¹äº‹ä»¶å¥‘çº¦ï¼‰
- **FR-006**: ç³»ç»Ÿ MUST ä¿æŒä¸ç°æœ‰ SSE äº‹ä»¶çš„å‘åå…¼å®¹
- **FR-007**: æ¯ä¸ªä»»åŠ¡ MUST æœ‰å”¯ä¸€ IDï¼Œå·¥å…·è°ƒç”¨ MUST å…³è”åˆ°çˆ¶ä»»åŠ¡ ID

### SSE äº‹ä»¶å¥‘çº¦

> **è®¾è®¡åŸåˆ™**ï¼šåŸºäº DeepAgents æ¡†æ¶çš„ Middleware æ¶æ„ï¼Œé‡‡ç”¨çŠ¶æ€é©±åŠ¨çš„äº‹ä»¶è®¾è®¡ã€‚
> é€šè¿‡ç›‘å¬ `stream_mode=["messages", "updates"]` è‡ªåŠ¨æ•è·çŠ¶æ€å˜åŒ–ï¼Œå‡å°‘æ‰‹åŠ¨äº‹ä»¶å‘å°„ã€‚

**ç°æœ‰äº‹ä»¶ï¼ˆä¿æŒå…¼å®¹ï¼‰**

| äº‹ä»¶ | ç”¨é€” | æ•°æ®ç»“æ„ |
|------|------|----------|
| `text_delta` | æµå¼æ–‡å­—è¾“å‡º | `{ text: string }` |
| `error` | é”™è¯¯ä¿¡æ¯ | `{ message: string }` |
| `done` | æµç»“æŸ | `{}` |

**å¢å¼ºçš„ç°æœ‰äº‹ä»¶**

| äº‹ä»¶ | å˜æ›´ | æ•°æ®ç»“æ„ |
|------|------|----------|
| `thinking` | å¢åŠ  `type` å­—æ®µåŒºåˆ†åœºæ™¯ | `{ type?: "planning" \| "replanning" \| "routing", content: string }` |
| `tool_call_start` | å¢åŠ å¯é€‰ `task_id` å…³è”ä»»åŠ¡ | `{ id: string, task_id?: string, name: string, args: object }` |
| `tool_call_result` | å¢åŠ å¯é€‰ `task_id` å…³è”ä»»åŠ¡ | `{ id: string, task_id?: string, name: string, status: string, output: string }` |

**æ–°å¢äº‹ä»¶ï¼ˆåŸºäº DeepAgents Middleware æ¨¡å¼ï¼‰**

| äº‹ä»¶ | ç”¨é€” | æ•°æ®ç»“æ„ | è§¦å‘æ¥æº |
|------|------|----------|----------|
| `todos_updated` | ä»»åŠ¡åˆ—è¡¨å˜æ›´ï¼ˆè§„åˆ’/é‡è§„åˆ’/çŠ¶æ€æ›´æ–°ï¼‰ | `{ todos: Todo[], timestamp: string }` | TodoListMiddleware çŠ¶æ€å˜åŒ– |
| `task_spawned` | å­ Agent ä»»åŠ¡å¼€å§‹ | `{ task_id: string, subagent_type: string, description: string }` | SubAgentMiddleware `task()` è°ƒç”¨å‰ |
| `task_completed` | å­ Agent ä»»åŠ¡å®Œæˆ | `{ task_id: string, duration_ms: number, status: "success" \| "error" }` | SubAgentMiddleware `task()` è¿”å›å |

**Todo æ•°æ®ç»“æ„ï¼ˆå¤ç”¨ DeepAgents TodoListMiddlewareï¼‰**

```typescript
interface Todo {
  content: string;                                    // ä»»åŠ¡æè¿°
  status: "pending" | "in_progress" | "completed";   // ä»»åŠ¡çŠ¶æ€
}
```

**äº‹ä»¶æ—¶åºç¤ºä¾‹**

```
åœºæ™¯ï¼šä¸“æœ‰ Agentï¼ˆ/sql æŸ¥è¯¢ï¼‰- å•ä»»åŠ¡ï¼Œç›´æ¥æ‰§è¡Œ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. task_spawned    { task_id: "t1", subagent_type: "sql", description: "SQL æŸ¥è¯¢" }
2. tool_call_start { id: "tc1", task_id: "t1", name: "sql_db_list_tables", args: {} }
3. tool_call_result{ id: "tc1", task_id: "t1", status: "success", output: "..." }
4. tool_call_start { id: "tc2", task_id: "t1", name: "sql_db_query", args: {...} }
5. tool_call_result{ id: "tc2", task_id: "t1", status: "success", ... }
6. task_completed  { task_id: "t1", duration_ms: 2340, status: "success" }
7. text_delta      { text: "æŸ¥è¯¢ç»“æœæ˜¾ç¤º..." }
8. done            {}

åœºæ™¯ï¼šè‡ªä¸»è§„åˆ’æ¨¡å¼ï¼ˆä½¿ç”¨ TodoListMiddlewareï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// è§„åˆ’é˜¶æ®µ - Agent è°ƒç”¨ write_todos å·¥å…·åˆ›å»ºä»»åŠ¡åˆ—è¡¨
1. thinking        { type: "planning", content: "æ­£åœ¨åˆ†æä»»åŠ¡..." }
2. thinking        { type: "planning", content: "è¯†åˆ«åˆ°éœ€è¦æ”¶é›†ä¸‰å®¶å…¬å¸çš„ä¿¡æ¯..." }
3. todos_updated   { todos: [                          // write_todos è§¦å‘
     { content: "æœç´¢å…¬å¸Aä¿¡æ¯", status: "pending" },
     { content: "æœç´¢å…¬å¸Bä¿¡æ¯", status: "pending" },
     { content: "å¯¹æ¯”åˆ†æ", status: "pending" }
   ], timestamp: "2025-02-13T10:30:00Z" }

// æ‰§è¡Œé˜¶æ®µ - å¹¶è¡Œæ‰§è¡Œå­ä»»åŠ¡
4. todos_updated   { todos: [                          // çŠ¶æ€å˜æ›´: pending â†’ in_progress
     { content: "æœç´¢å…¬å¸Aä¿¡æ¯", status: "in_progress" },
     { content: "æœç´¢å…¬å¸Bä¿¡æ¯", status: "in_progress" },
     { content: "å¯¹æ¯”åˆ†æ", status: "pending" }
   ], timestamp: "..." }
5. task_spawned    { task_id: "t1", subagent_type: "research", description: "æœç´¢å…¬å¸Aä¿¡æ¯" }
6. task_spawned    { task_id: "t2", subagent_type: "research", description: "æœç´¢å…¬å¸Bä¿¡æ¯" }
7. tool_call_start { id: "tc1", task_id: "t1", name: "tavily_search", args: {...} }
8. tool_call_start { id: "tc2", task_id: "t2", name: "tavily_search", args: {...} }
9. tool_call_result{ id: "tc1", task_id: "t1", status: "success", ... }
10. task_completed { task_id: "t1", duration_ms: 1500, status: "success" }
11. todos_updated  { todos: [                          // ä»»åŠ¡Aå®Œæˆ
      { content: "æœç´¢å…¬å¸Aä¿¡æ¯", status: "completed" },
      { content: "æœç´¢å…¬å¸Bä¿¡æ¯", status: "in_progress" },
      { content: "å¯¹æ¯”åˆ†æ", status: "pending" }
    ], timestamp: "..." }

// é‡è§„åˆ’é˜¶æ®µï¼ˆå¯é€‰ï¼‰- Agent ä¿®æ”¹ todos
12. thinking       { type: "replanning", content: "å‘ç°éœ€è¦è¡¥å……æ•°æ®..." }
13. todos_updated  { todos: [                          // æ–°å¢ä»»åŠ¡
      { content: "æœç´¢å…¬å¸Aä¿¡æ¯", status: "completed" },
      { content: "æœç´¢å…¬å¸Bä¿¡æ¯", status: "in_progress" },
      { content: "å¯¹æ¯”åˆ†æ", status: "pending" },
      { content: "è¡¥å……æ•°æ®æ”¶é›†", status: "pending" }   // â† æ–°å¢
    ], timestamp: "..." }

// ç»§ç»­æ‰§è¡Œç›´åˆ°å®Œæˆ
14. tool_call_result{ id: "tc2", task_id: "t2", ... }
15. task_completed { task_id: "t2", duration_ms: 2100, status: "success" }
16. todos_updated  { todos: [...å…¨éƒ¨ completed...], timestamp: "..." }

// ç»“æœé˜¶æ®µ
17. text_delta     { text: "ç»¼åˆåˆ†æç»“æœ..." }
18. done           {}

åœºæ™¯ï¼šå¿«é€Ÿå›ç­” - æ— è§„åˆ’ï¼Œæ— ä»»åŠ¡ï¼Œç›´æ¥è¾“å‡º
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. text_delta      { text: "ä½ å¥½ï¼" }
2. text_delta      { text: "æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ" }
3. done            {}
```

**å®ç°æ¶æ„ï¼ˆåŸºäº DeepAgentsï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  stream_handler.py                                          â”‚
â”‚  â””â”€ agent.astream(stream_mode=["messages", "updates"])      â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€ messages â†’ text_delta, tool_call_*, thinking       â”‚
â”‚       â”‚                                                     â”‚
â”‚       â””â”€ updates  â†’ æ£€æµ‹çŠ¶æ€å˜åŒ–                             â”‚
â”‚            â”œâ”€ todos å˜åŒ– â†’ todos_updated                    â”‚
â”‚            â””â”€ subagent è°ƒç”¨ â†’ task_spawned/task_completed   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DeepAgents Middleware Stack                                â”‚
â”‚  â”œâ”€ TodoListMiddleware     â†’ ç®¡ç† todos çŠ¶æ€                â”‚
â”‚  â”œâ”€ SubAgentMiddleware     â†’ ç®¡ç†å­ Agent è°ƒç”¨              â”‚
â”‚  â””â”€ EventEmissionMiddleware (æ–°å¢) â†’ æ‹¦æˆªçŠ¶æ€å˜åŒ–å‘å°„äº‹ä»¶    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åœºæ™¯åˆ‡æ¢**

- **FR-008**: å¿«é€Ÿå›ç­”åœºæ™¯ MUST åªæ˜¾ç¤ºç»“æœåŒºï¼Œéšè—æ€è€ƒåŒºå’Œæ‰§è¡ŒåŒº
- **FR-009**: ä¸“æœ‰ Agent åœºæ™¯ MUST æ˜¾ç¤ºæ‰§è¡ŒåŒºï¼ˆå•ä»»åŠ¡æ ‘ï¼‰å’Œç»“æœåŒºï¼Œæ€è€ƒåŒºå¯é€‰
- **FR-010**: è‡ªä¸»è§„åˆ’åœºæ™¯ MUST æ˜¾ç¤ºå®Œæ•´ä¸‰å±‚ç»“æ„

**å®æ—¶æ›´æ–°**

- **FR-011**: ä»»åŠ¡çŠ¶æ€å˜æ›´ MUST å®æ—¶åæ˜ åœ¨ç•Œé¢ä¸Šï¼Œå»¶è¿Ÿä¸è¶…è¿‡ 100ms
- **FR-012**: å·¥å…·è°ƒç”¨è¿›åº¦ MUST æœ‰è§†è§‰åé¦ˆï¼ˆloading åŠ¨ç”»ï¼‰

**äº¤äº’èƒ½åŠ›**

- **FR-013**: ç”¨æˆ· MUST èƒ½å¤Ÿå±•å¼€/æŠ˜å ä»»åŠ¡èŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ…
- **FR-014**: ç”¨æˆ· MUST èƒ½å¤Ÿå¤åˆ¶å·¥å…·è°ƒç”¨çš„è¾“å…¥å‚æ•°å’Œè¾“å‡ºç»“æœ

### Key Entities

- **Todo**: ä»£è¡¨ä¸€ä¸ªè§„åˆ’ä»»åŠ¡ï¼ˆå¤ç”¨ DeepAgents TodoListMiddlewareï¼‰
  - å±æ€§ï¼šcontent (string), status ("pending" | "in_progress" | "completed")
  - è¯´æ˜ï¼šç”± Agent é€šè¿‡ `write_todos` å·¥å…·åˆ›å»ºå’Œæ›´æ–°ï¼ŒçŠ¶æ€å˜åŒ–è‡ªåŠ¨è§¦å‘ `todos_updated` äº‹ä»¶
  - å‰ç«¯æ˜ å°„ï¼šæ¯ä¸ª Todo åœ¨ä»»åŠ¡æ ‘ä¸­æ˜¾ç¤ºä¸ºä¸€ä¸ªå¶å­èŠ‚ç‚¹

- **SpawnedTask**: ä»£è¡¨ä¸€ä¸ªå­ Agent æ‰§è¡Œå®ä¾‹
  - å±æ€§ï¼štask_id, subagent_type, description, duration_ms, status
  - è¯´æ˜ï¼šç”± SubAgentMiddleware çš„ `task()` å·¥å…·è§¦å‘ï¼Œç”¨äºè¿½è¸ªå­ Agent ç”Ÿå‘½å‘¨æœŸ
  - å…³è”ï¼šå·¥å…·è°ƒç”¨é€šè¿‡ `task_id` å…³è”åˆ°æ­¤ä»»åŠ¡

- **ToolCall**: ä»£è¡¨ä¸€æ¬¡å·¥å…·è°ƒç”¨
  - å±æ€§ï¼šid, task_id (å¯é€‰), name, args, status, output
  - è¯´æ˜ï¼šå½“å­˜åœ¨ task_id æ—¶ï¼Œå½’å±äºå¯¹åº”çš„ SpawnedTaskï¼›å¦åˆ™ä¸ºé¡¶å±‚è°ƒç”¨

- **ThinkingStep**: ä»£è¡¨æ€è€ƒ/è§„åˆ’è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªæ­¥éª¤
  - å±æ€§ï¼štype (planning/replanning/routingï¼Œå¯é€‰), content
  - è¯´æ˜ï¼šæ˜¾ç¤ºåœ¨æ€è€ƒåŒºï¼Œåªåœ¨è§„åˆ’/é‡è§„åˆ’é˜¶æ®µå‡ºç°

### å‘åå…¼å®¹æ€§

- ç°æœ‰å‰ç«¯ä»£ç å¦‚æœä¸å¤„ç†æ–°äº‹ä»¶ï¼ˆ`todos_updated`, `task_spawned`, `task_completed`ï¼‰ï¼Œä»èƒ½æ­£å¸¸æ˜¾ç¤ºå·¥å…·è°ƒç”¨
- `tool_call_start` å’Œ `tool_call_result` å¢åŠ çš„ `task_id` å­—æ®µä¸ºå¯é€‰ï¼Œæ—§ç‰ˆå‰ç«¯å¯å¿½ç•¥
- `thinking` äº‹ä»¶å¢åŠ çš„ `type` å­—æ®µä¸ºå¯é€‰ï¼Œæ—§ç‰ˆå‰ç«¯å¯åªæ˜¾ç¤º `content`
- æ–°äº‹ä»¶é‡‡ç”¨å¢é‡è®¾è®¡ï¼Œä¸ä¿®æ”¹ç°æœ‰äº‹ä»¶çš„å¿…å¡«å­—æ®µ

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: å¿«é€Ÿå›ç­”åœºæ™¯çš„ç•Œé¢å“åº”æ—¶é—´ï¼ˆä»æ”¶åˆ°é¦–ä¸ª SSE äº‹ä»¶åˆ°å†…å®¹å¯è§ï¼‰ä¸è¶…è¿‡ 100ms
- **SC-002**: ç”¨æˆ·èƒ½åœ¨ 3 ç§’å†…ç†è§£å½“å‰ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆé€šè¿‡ä»»åŠ¡æ ‘çš„è§†è§‰è®¾è®¡ï¼‰
- **SC-003**: 90% çš„æµ‹è¯•ç”¨æˆ·èƒ½å¤Ÿæ­£ç¡®åŒºåˆ†ä¸‰ç§åœºæ™¯çš„æ˜¾ç¤ºæ¨¡å¼
- **SC-004**: ä»»åŠ¡æ ‘æ”¯æŒå±•ç¤ºè‡³å°‘ 10 ä¸ªå¹¶è¡Œä»»åŠ¡ï¼Œæ— æ˜æ˜¾å¡é¡¿
- **SC-005**: å·¥å…·è°ƒç”¨è¯¦æƒ…çš„å±•å¼€/æŠ˜å æ“ä½œå“åº”æ—¶é—´ä¸è¶…è¿‡ 50ms

## Assumptions

- åç«¯ä½¿ç”¨ DeepAgents æ¡†æ¶ï¼Œå·²æœ‰ä»¥ä¸‹ Middleware æ”¯æŒï¼š
  - **TodoListMiddleware**: æä¾› `write_todos` å·¥å…·ç®¡ç†ä»»åŠ¡åˆ—è¡¨
  - **SubAgentMiddleware**: æä¾› `task()` å·¥å…·å§”æ‰˜å­ Agent æ‰§è¡Œ
  - **SummarizationMiddleware**: è‡ªåŠ¨æ‘˜è¦é•¿ä¸Šä¸‹æ–‡
- LangGraph `astream()` æ”¯æŒ `stream_mode=["messages", "updates"]` æ•è·çŠ¶æ€å˜åŒ–
- ç°æœ‰ SSE åŸºç¡€è®¾æ–½ï¼ˆstream_handler.pyï¼‰å¯æ‰©å±•æ”¯æŒæ–°äº‹ä»¶ç±»å‹
- å‰ç«¯ä½¿ç”¨ Reactï¼Œæ”¯æŒå®æ—¶çŠ¶æ€æ›´æ–°
