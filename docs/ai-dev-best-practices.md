# AI åä½œå¼€å‘æœ€ä½³å®è·µ

## æ ¸å¿ƒåŸåˆ™

**AI æ˜¯åŠ é€Ÿå™¨ï¼Œä¸æ˜¯æ›¿ä»£å“** â€” äººè´Ÿè´£æ¶æ„å†³ç­–å’Œä»£ç å®¡æŸ¥ï¼ŒAI è´Ÿè´£å®ç°ç»†èŠ‚ã€‚

### æ¶æ„çº¦æŸæ–‡æ¡£

| AI å·¥å…· | é…ç½®æ–‡ä»¶ | è¯´æ˜ |
|---------|----------|------|
| é€šç”¨ | `docs/architecture.md` | æ¶æ„è§„èŒƒï¼ˆæ‰€æœ‰äººå¿…è¯»ï¼‰ |
| Claude Code | `CLAUDE.md` | Claude ä¸“ç”¨æŒ‡å— |
| Cursor | `.cursorrules` | Cursor ä¸“ç”¨è§„åˆ™ |
| GitHub Copilot | `.github/copilot-instructions.md` | Copilot ä¸“ç”¨æŒ‡å— |

**æ‰€æœ‰é…ç½®æ–‡ä»¶å¼•ç”¨åŒä¸€ä»½ `docs/architecture.md`ï¼Œç¡®ä¿æ¶æ„çº¦æŸä¸€è‡´ã€‚**

---

## 1. åŸºäº Speckit çš„å¤šäººåä½œæµç¨‹

### æ•´ä½“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PM / æ¶æ„å¸ˆ                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  /speckit.specify "åŠŸèƒ½æè¿°"                                             â”‚
â”‚       â†“                                                                  â”‚
â”‚  specs/003-xxx/spec.md  â† åªå®šä¹‰éœ€æ±‚ï¼ˆWHATï¼‰                             â”‚
â”‚       â†“                                                                  â”‚
â”‚  åˆ†é… Spec ç»™å¼€å‘è€…                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¼€å‘è€… A      â”‚ â”‚   å¼€å‘è€… B      â”‚ â”‚   å¼€å‘è€… C      â”‚
â”‚   (Spec 015)    â”‚ â”‚   (Spec 003)    â”‚ â”‚   (Spec 004)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /speckit.plan   â”‚ â”‚ /speckit.plan   â”‚ â”‚ /speckit.plan   â”‚
â”‚ â†’ plan.md       â”‚ â”‚ â†’ plan.md       â”‚ â”‚ â†’ plan.md       â”‚
â”‚       â†“         â”‚ â”‚       â†“         â”‚ â”‚       â†“         â”‚
â”‚ (æ¶æ„å¸ˆå®¡æ ¸)    â”‚ â”‚ (æ¶æ„å¸ˆå®¡æ ¸)    â”‚ â”‚ (æ¶æ„å¸ˆå®¡æ ¸)    â”‚
â”‚       â†“         â”‚ â”‚       â†“         â”‚ â”‚       â†“         â”‚
â”‚ /speckit.tasks  â”‚ â”‚ /speckit.tasks  â”‚ â”‚ /speckit.tasks  â”‚
â”‚ â†’ tasks.md      â”‚ â”‚ â†’ tasks.md      â”‚ â”‚ â†’ tasks.md      â”‚
â”‚       â†“         â”‚ â”‚       â†“         â”‚ â”‚       â†“         â”‚
â”‚ /speckit.implement â”‚ /speckit.implement â”‚ /speckit.implement
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŒè´£åˆ’åˆ†

| è§’è‰² | èŒè´£ | äº§å‡º | å·¥å…· |
|------|------|------|------|
| **PM** | éœ€æ±‚å®šä¹‰ | spec.md | `/speckit.specify` |
| **æ¶æ„å¸ˆ** | å®¡æ ¸æŠ€æœ¯æ–¹æ¡ˆ | å®¡æ‰¹/åé¦ˆ | Review plan.md |
| **å¼€å‘è€…** | æŠ€æœ¯æ–¹æ¡ˆ + ä»»åŠ¡åˆ†è§£ + å®ç° | plan.md + tasks.md + ä»£ç  | `/speckit.plan` â†’ `/speckit.tasks` â†’ `/speckit.implement` |

### Spec åˆ†é…ç¤ºä¾‹

| Spec | è´Ÿè´£å¼€å‘è€… | çŠ¶æ€ |
|------|------------|------|
| 003-enterprise-knowledge | å¼€å‘è€… B | å¼€å‘ä¸­ |
| 004-data-analysis-agent | å¼€å‘è€… C | å¼€å‘ä¸­ |
| 015-supervisor-optimization | å¼€å‘è€… A | å¼€å‘ä¸­ |
| 017-sql-datasource | å¼€å‘è€… C | å¾…å¼€å§‹ |
| 008-enterprise-integration | å¼€å‘è€… D | å¾…å¼€å§‹ |

### Speckit å‘½ä»¤é€ŸæŸ¥

| å‘½ä»¤ | ç”¨é€” | ä½¿ç”¨è€… |
|------|------|--------|
| `/speckit.specify` | åˆ›å»ºéœ€æ±‚è§„æ ¼ | PM |
| `/speckit.clarify` | æ¾„æ¸…éœ€æ±‚ç»†èŠ‚ | PM/å¼€å‘è€… |
| `/speckit.plan` | ç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆ | å¼€å‘è€… |
| `/speckit.tasks` | ç”Ÿæˆä»»åŠ¡åˆ—è¡¨ | å¼€å‘è€… |
| `/speckit.implement` | æ‰§è¡Œå®ç°ä»»åŠ¡ | å¼€å‘è€… |
| `/speckit.analyze` | æ£€æŸ¥ä¸€è‡´æ€§ | ä»»ä½•äºº |
| `/speckit.checklist` | ç”Ÿæˆæ£€æŸ¥æ¸…å• | QA/å¼€å‘è€… |

---

## 2. åˆ†æ”¯ç®¡ç†ç­–ç•¥

### æ ¸å¿ƒåŸåˆ™

**ä¸€ä¸ª Spec = ä¸€ä¸ªåˆ†æ”¯ = ä¸€ä¸ª PR**

```
main â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€
        â”‚                             â”‚        â”‚        â”‚
        â””â”€â”€ 003-enterprise-knowledge â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
            (PMåˆ›å»ºï¼Œå¼€å‘è€…Bç»§ç»­)      â”‚                 â”‚
                                      â”‚                 â”‚
        â””â”€â”€ 015-supervisor-opt â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            (PMåˆ›å»ºï¼Œå¼€å‘è€…Aç»§ç»­)      â”‚
                                      â”‚
        â””â”€â”€ 017-sql-datasource â”€â”€â”€â”€â”€â”€â”€â”˜
            (PMåˆ›å»ºï¼Œå¼€å‘è€…Cç»§ç»­)
```

### åˆ†æ”¯ç”Ÿå‘½å‘¨æœŸ

| é˜¶æ®µ | æ“ä½œè€… | åŠ¨ä½œ |
|------|--------|------|
| åˆ›å»º | PM | `/speckit.specify` è‡ªåŠ¨åˆ›å»ºåˆ†æ”¯ + spec.md |
| åˆ†é… | PM | é€šçŸ¥å¼€å‘è€…æ¥æ‰‹è¯¥åˆ†æ”¯ |
| å¼€å‘ | å¼€å‘è€… | åœ¨åˆ†æ”¯ä¸Šå®Œæˆ plan â†’ tasks â†’ implement |
| åˆå¹¶ | å¼€å‘è€… | åˆ›å»º PRï¼Œæ¶æ„å¸ˆå®¡æ ¸ååˆå¹¶åˆ° main |
| æ¸…ç† | è‡ªåŠ¨ | åˆå¹¶ååˆ é™¤åˆ†æ”¯ |

### PM æ“ä½œæµç¨‹

```bash
# 1. åœ¨ main åˆ†æ”¯åˆ›å»ºæ–° Spec
git checkout main && git pull
/speckit.specify "ä¼ä¸šçŸ¥è¯†åº“ç®¡ç†"
# â†’ è‡ªåŠ¨åˆ›å»º 003-enterprise-knowledge åˆ†æ”¯
# â†’ è‡ªåŠ¨ç”Ÿæˆ specs/003-enterprise-knowledge/spec.md

# 2. æ¨é€åˆ°è¿œç¨‹
git push -u origin 003-enterprise-knowledge

# 3. åˆ†é…ç»™å¼€å‘è€…
# åœ¨é¡¹ç›®ç®¡ç†å·¥å…·æˆ–ç¾¤é‡Œé€šçŸ¥ï¼š
# "@å¼€å‘è€…B è¯·æ¥æ‰‹ 003-enterprise-knowledge åˆ†æ”¯"

# 4. ç»§ç»­åˆ›å»ºä¸‹ä¸€ä¸ª Spec
git checkout main
/speckit.specify "SQLæ•°æ®æºé…ç½®"
# ...
```

### å¼€å‘è€…æ“ä½œæµç¨‹

```bash
# 1. æ‹‰å–åˆ†é…çš„ Spec åˆ†æ”¯
git fetch origin
git checkout 003-enterprise-knowledge

# 2. é˜…è¯»éœ€æ±‚ï¼Œç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆ
cat specs/003-enterprise-knowledge/spec.md
/speckit.plan
# â†’ ç”Ÿæˆ plan.md

# 3. æäº¤ plan.md ç»™æ¶æ„å¸ˆå®¡æ ¸
git add specs/003-enterprise-knowledge/plan.md
git commit -m "plan(003): ä¼ä¸šçŸ¥è¯†åº“æŠ€æœ¯æ–¹æ¡ˆ"
git push

# 4. æ¶æ„å¸ˆå®¡æ ¸é€šè¿‡åï¼Œç”Ÿæˆä»»åŠ¡å¹¶å®ç°
/speckit.tasks
/speckit.implement

# 5. å®Œæˆååˆ›å»º PR
gh pr create --base main --title "feat(003): ä¼ä¸šçŸ¥è¯†åº“ç®¡ç†"
```

### å¹¶è¡Œå¼€å‘ç¤ºä¾‹

```bash
# å¼€å‘è€… C åŒæ—¶è´Ÿè´£ä¸¤ä¸ª Spec

# --- å·¥ä½œäº Spec 004 ---
git checkout 004-data-analysis-agent
/speckit.plan
git commit -m "plan(004): æ•°æ®åˆ†æAgentæ–¹æ¡ˆ"
git push
# ç­‰å¾…æ¶æ„å¸ˆå®¡æ ¸...

# --- åˆ‡æ¢åˆ° Spec 017 ---
git checkout 017-sql-datasource
/speckit.plan
git commit -m "plan(017): SQLæ•°æ®æºæ–¹æ¡ˆ"
git push

# --- å›åˆ° Spec 004ï¼ˆå®¡æ ¸é€šè¿‡åï¼‰---
git checkout 004-data-analysis-agent
/speckit.tasks
/speckit.implement
```

### çº¦æŸ

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| ä¸€äººä¸€ Spec | é¿å…åŒåˆ†æ”¯å¤šäººåä½œå†²çª |
| åˆ†æ”¯å‘½å | `{ç¼–å·}-{çŸ­å}` ç”± speckit è‡ªåŠ¨ç”Ÿæˆ |
| åˆå¹¶ç›®æ ‡ | æ‰€æœ‰ PR åˆå¹¶åˆ° main |
| åŠæ—¶åŒæ­¥ | å¼€å‘å‰ `git pull origin main` è·å–æœ€æ–°ä»£ç  |

---

## 3. å¼€å‘è€…å·¥ä½œæµç¨‹

### æ¥åˆ° Spec åçš„æµç¨‹

```bash
# 1. åˆ‡æ¢åˆ°åˆ†é…çš„ Spec åˆ†æ”¯
git fetch origin
git checkout 003-enterprise-knowledge

# 2. é˜…è¯»éœ€æ±‚è§„æ ¼
cat specs/003-enterprise-knowledge/spec.md

# 3. ç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆ
/speckit.plan
# â†’ ç”Ÿæˆ plan.md

# 4. æäº¤ plan.md ç»™æ¶æ„å¸ˆå®¡æ ¸
git add specs/003-enterprise-knowledge/plan.md
git commit -m "plan(003): ä¼ä¸šçŸ¥è¯†åº“æŠ€æœ¯æ–¹æ¡ˆ"
git push

# 5. å®¡æ ¸é€šè¿‡åï¼Œç”Ÿæˆä»»åŠ¡åˆ—è¡¨
/speckit.tasks
# â†’ ç”Ÿæˆ tasks.md

# 6. å¼€å§‹å®ç°
/speckit.implement

# 7. å®Œæˆååˆ›å»º PR
gh pr create --base main --title "feat(003): ä¼ä¸šçŸ¥è¯†åº“ç®¡ç†"
```

### plan.md å®¡æ ¸è¦ç‚¹

æ¶æ„å¸ˆå®¡æ ¸ plan.md æ—¶å…³æ³¨ï¼š

| å®¡æ ¸é¡¹ | è¯´æ˜ |
|--------|------|
| åˆ†å±‚æ¶æ„ | æ˜¯å¦éµå¾ª Agent â†’ Service â†’ Repository |
| æ¥å£è®¾è®¡ | æ˜¯å¦ä¸å…¶ä»– Spec çš„æ¥å£å…¼å®¹ |
| æŠ€æœ¯é€‰å‹ | æ˜¯å¦ç¬¦åˆé¡¹ç›®æŠ€æœ¯æ ˆ |
| ä¾èµ–å…³ç³» | æ˜¯å¦ä¸å…¶ä»– Spec æœ‰å†²çª |

### æ–‡ä»¶æ‰€æœ‰æƒ

| æ–‡ä»¶/ç›®å½• | è´Ÿè´£äºº | è¯´æ˜ |
|-----------|--------|------|
| `specs/003-xxx/` | å¼€å‘è€… B | å®Œæ•´è´Ÿè´£è¯¥ Spec |
| `specs/004-xxx/` | å¼€å‘è€… C | å®Œæ•´è´Ÿè´£è¯¥ Spec |
| `shared/` | éœ€åè°ƒ | ä¿®æ”¹å‰å…ˆæ²Ÿé€š |
| `contracts/` | æ¶æ„å¸ˆå®¡æ‰¹ | æ¥å£å˜æ›´éœ€è¯„å®¡ |

---

## 4. ç›®å½•æ‰€æœ‰æƒç®¡ç†

### ä½¿ç”¨ GitHub CODEOWNERS

é€šè¿‡ `.github/CODEOWNERS` æ–‡ä»¶å®ç°ç›®å½•çº§åˆ«çš„æƒé™æ§åˆ¶ï¼š

```
# .github/CODEOWNERS

# é»˜è®¤æ‰€æœ‰è€…ï¼ˆæ¶æ„å¸ˆå®¡æ‰¹ï¼‰
* @architect

# ============ Spec ç›®å½• ============
# Agent æ¶æ„ç›¸å…³
/specs/015-*/ @dev-a
/specs/016-*/ @dev-a

# çŸ¥è¯†åº“ç®¡ç†ç›¸å…³
/specs/003-*/ @dev-b
/specs/005-*/ @dev-b

# æ•°æ®åˆ†æç›¸å…³
/specs/004-*/ @dev-c
/specs/017-*/ @dev-c

# åŸºç¡€è®¾æ–½ç›¸å…³
/specs/002-*/ @dev-d
/specs/008-*/ @dev-d

# ============ ä»£ç ç›®å½• ============
# Agent æ¶æ„
/backend/supervisor.py @dev-a
/backend/registry.py @dev-a

# çŸ¥è¯†åº“ç®¡ç†
/backend/agents/knowledge*.py @dev-b
/backend/services/knowledge*.py @dev-b
/backend/repositories/document*.py @dev-b

# æ•°æ®åˆ†æ
/backend/agents/analysis*.py @dev-c
/backend/services/datasource*.py @dev-c

# åŸºç¡€è®¾æ–½
/backend/auth/ @dev-d
/backend/db.py @dev-d
/backend/conversations/ @dev-d
/infra/ @dev-d
/docker-compose.yml @dev-d

# ============ å…±äº«èµ„æºï¼ˆéœ€æ¶æ„å¸ˆå®¡æ‰¹ï¼‰ ============
/backend/contracts/ @architect
/backend/shared/ @architect
/docs/architecture.md @architect
/.specify/memory/constitution.md @architect
```

### CODEOWNERS æ•ˆæœ

| åœºæ™¯ | è¡Œä¸º |
|------|------|
| å¼€å‘è€…ä¿®æ”¹è‡ªå·±ç›®å½• | PR æ­£å¸¸åˆ›å»º |
| å¼€å‘è€…ä¿®æ”¹ä»–äººç›®å½• | è‡ªåŠ¨è¯·æ±‚å¯¹åº”æ‰€æœ‰è€…å®¡æ ¸ |
| ä¿®æ”¹å…±äº«èµ„æº | è‡ªåŠ¨è¯·æ±‚æ¶æ„å¸ˆå®¡æ ¸ |
| æœªå®šä¹‰çš„ç›®å½• | è‡ªåŠ¨è¯·æ±‚é»˜è®¤æ‰€æœ‰è€…ï¼ˆæ¶æ„å¸ˆï¼‰å®¡æ ¸ |

### æ‰€æœ‰æƒåˆ†é…åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| Spec å¯¹åº”ä»£ç  | è´Ÿè´£æŸ Spec çš„å¼€å‘è€…åŒæ—¶æ‹¥æœ‰ç›¸å…³ä»£ç ç›®å½• |
| å•ä¸€æ‰€æœ‰è€… | æ¯ä¸ªç›®å½•åªæœ‰ä¸€ä¸ªä¸»è¦æ‰€æœ‰è€…ï¼Œé¿å…è´£ä»»åˆ†æ•£ |
| å…±äº«éœ€å®¡æ‰¹ | `contracts/`ã€`shared/` ç­‰å…±äº«ç›®å½•éœ€æ¶æ„å¸ˆå®¡æ‰¹ |
| åŸºç¡€è®¾æ–½é›†ä¸­ | æ•°æ®åº“ã€è®¤è¯ã€éƒ¨ç½²ç­‰åŸºç¡€è®¾æ–½ç”±ä¸“äººè´Ÿè´£ |

### è·¨ç›®å½•ä¿®æ”¹æµç¨‹

å½“éœ€è¦ä¿®æ”¹ä¸å±äºè‡ªå·±çš„ç›®å½•æ—¶ï¼š

```
1. åœ¨ç¾¤é‡Œ @æ‰€æœ‰è€… è¯´æ˜ä¿®æ”¹éœ€æ±‚
       â†“
2. æ‰€æœ‰è€…è¯„ä¼°å½±å“
       â†“
3a. ç®€å•ä¿®æ”¹ï¼šæ‰€æœ‰è€…è‡ªå·±å®Œæˆ
3b. å¤æ‚ä¿®æ”¹ï¼šæ‰€æœ‰è€…åˆ›å»ºæ¥å£ï¼Œè¯·æ±‚æ–¹ä½¿ç”¨æ¥å£
3c. ç´§æ€¥æƒ…å†µï¼šè¯·æ±‚æ–¹ä¿®æ”¹ï¼Œæ‰€æœ‰è€…å®¡æ ¸ PR
```

### é…ç½®æ­¥éª¤

1. ç¡®è®¤å¼€å‘è€…åˆ†å·¥å’Œ GitHub ç”¨æˆ·å
2. åˆ›å»º `.github/CODEOWNERS` æ–‡ä»¶
3. åœ¨ä»“åº“ Settings â†’ Branches â†’ Branch protection rules ä¸­å¯ç”¨ï¼š
   - Require pull request reviews before merging
   - Require review from Code Owners

---

## 5. plan.md æŠ€æœ¯æ–¹æ¡ˆ

### å¼€å‘è€…ç”Ÿæˆ plan.md

å¼€å‘è€…æ¥åˆ° spec.md åï¼Œè¿è¡Œ `/speckit.plan` ç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆï¼š

```markdown
## Architecture

### Layer Structure
Agent â†’ Service â†’ Repository â†’ DB

### File Structure
- Agent: agents/knowledge_agent.py
- Service: services/knowledge_service.py
- Repository: repositories/document_repository.py

### Interfaces
contracts/knowledge.py:
- KnowledgeServiceInterface
- DocumentRepositoryInterface

## Technical Decisions

### Why OpenSearch over pgvector?
- æ›´å¥½çš„å…¨æ–‡æœç´¢æ”¯æŒ
- æ›´çµæ´»çš„ç´¢å¼•é…ç½®

## Database Schema
(å®šä¹‰è¡¨ç»“æ„)

## API Contracts
(å®šä¹‰ API æ¥å£)

## Dependencies
- ä¾èµ– Spec 017 (SQLæ•°æ®æº) çš„ DatasourceService
- è¢« Spec 005 (è´¨é‡åˆ†æ) ä¾èµ–
```

### æ¶æ„å¸ˆå®¡æ ¸ plan.md

å¼€å‘è€…åœ¨ Spec åˆ†æ”¯ä¸Šæäº¤ plan.md åï¼Œé€šçŸ¥æ¶æ„å¸ˆå®¡æ ¸ï¼š

```bash
# å¼€å‘è€…åœ¨ Spec åˆ†æ”¯ä¸Šæäº¤
git checkout 003-enterprise-knowledge
git add specs/003-enterprise-knowledge/plan.md
git commit -m "plan(003): ä¼ä¸šçŸ¥è¯†åº“æŠ€æœ¯æ–¹æ¡ˆ"
git push

# é€šçŸ¥æ¶æ„å¸ˆå®¡æ ¸ï¼ˆæ— éœ€åˆ›å»º PRï¼Œç›´æ¥åœ¨åˆ†æ”¯ä¸Šå®¡æ ¸ï¼‰
# æ¶æ„å¸ˆå®¡æ ¸è¦ç‚¹ï¼š
# - åˆ†å±‚æ¶æ„æ˜¯å¦æ­£ç¡®
# - ä¸å…¶ä»– Spec æ¥å£æ˜¯å¦å…¼å®¹
# - æŠ€æœ¯é€‰å‹æ˜¯å¦åˆç†

# å®¡æ ¸é€šè¿‡åï¼Œå¼€å‘è€…ç»§ç»­åœ¨åŒä¸€åˆ†æ”¯ä¸Šå®ç°
```

### è·¨ Spec æ¥å£åè°ƒ

å½“å¤šä¸ª Spec æœ‰ä¾èµ–æ—¶ï¼š

```
Spec 017 (SQLæ•°æ®æº)     Spec 003 (çŸ¥è¯†åº“)
å¼€å‘è€… C                  å¼€å‘è€… B
     â”‚                        â”‚
     â–¼                        â–¼
DatasourceService  â—„â”€â”€â”€â”€  ä¾èµ–æ­¤æ¥å£
     â”‚
     â–¼
å…ˆå®šä¹‰æ¥å£ â†’ æ¶æ„å¸ˆå®¡æ ¸ â†’ å¼€å‘è€… B å¯ä»¥å¼€å§‹
```

### æ¶æ„ä¸€è‡´æ€§ç®¡ç†

å¤šä¸ª Spec å¹¶è¡Œå¼€å‘æ—¶ï¼Œplan.md ä¹‹é—´å¯èƒ½äº§ç”Ÿæ¶æ„å†³ç­–å†²çªï¼ˆé git æ–‡ä»¶å†²çªï¼‰ã€‚

#### åˆ†å±‚æ¶æ„çº¦æŸ

```
specs/
â”œâ”€â”€ 003-enterprise-knowledge/
â”‚   â””â”€â”€ plan.md  â† å¼€å‘è€… Bï¼ˆSpec çº§æ–¹æ¡ˆï¼‰
â”œâ”€â”€ 017-sql-datasource/
â”‚   â””â”€â”€ plan.md  â† å¼€å‘è€… Cï¼ˆSpec çº§æ–¹æ¡ˆï¼‰
â”‚
contracts/        â† å…±äº«æ¥å£å®šä¹‰ï¼ˆæ¶æ„å¸ˆå®¡æ‰¹ï¼‰
â”‚   â”œâ”€â”€ knowledge.py
â”‚   â””â”€â”€ datasource.py
â”‚
CLAUDE.md         â† å…¨å±€æ¶æ„çº¦æŸï¼ˆæ¶æ„å¸ˆç»´æŠ¤ï¼‰
```

#### èŒè´£è¾¹ç•Œ

| å±‚çº§ | æ–‡ä»¶ | å†…å®¹ | ç»´æŠ¤è€… |
|------|------|------|--------|
| **å…¨å±€** | `CLAUDE.md` | æŠ€æœ¯æ ˆã€åˆ†å±‚è§„èŒƒã€å‘½åçº¦å®š | æ¶æ„å¸ˆ |
| **å…±äº«** | `contracts/` | è·¨ Spec çš„æ¥å£å®šä¹‰ | æ¶æ„å¸ˆå®¡æ‰¹ |
| **Spec** | `plan.md` | å…·ä½“å®ç°æ–¹æ¡ˆ | å¼€å‘è€… |

#### å†²çªé¢„é˜²

| åœºæ™¯ | é¢„é˜²æªæ–½ |
|------|----------|
| æŠ€æœ¯é€‰å‹å†²çª | åœ¨ CLAUDE.md ä¸­é¢„å®šä¹‰æŠ€æœ¯æ ˆ |
| æ¥å£å®šä¹‰å†²çª | æ–°æ¥å£å¿…é¡»æäº¤åˆ° contracts/ å¹¶ç»æ¶æ„å¸ˆå®¡æ‰¹ |
| ä¾èµ–æ–¹å‘è¿è§„ | æ¶æ„å®ˆæŠ¤æµ‹è¯•è‡ªåŠ¨æ£€æµ‹ |
| å…±äº«ä»£ç å†²çª | shared/ ç›®å½•ä¿®æ”¹å‰å…ˆåœ¨ç¾¤é‡Œæ²Ÿé€š |

#### æ¶æ„å¸ˆå®¡æ ¸ plan.md æ£€æŸ¥é¡¹

```markdown
â–¡ æ˜¯å¦ç¬¦åˆ CLAUDE.md çš„å…¨å±€çº¦æŸï¼Ÿ
â–¡ æ˜¯å¦ä¸å…¶ä»– Spec çš„ plan.md æŠ€æœ¯é€‰å‹ä¸€è‡´ï¼Ÿ
â–¡ æ–°å¢æ¥å£æ˜¯å¦å·²æäº¤åˆ° contracts/ï¼Ÿ
â–¡ ä¾èµ–çš„å…¶ä»– Spec æ¥å£æ˜¯å¦å·²å®šä¹‰ï¼Ÿ
â–¡ æ˜¯å¦æœ‰æ½œåœ¨çš„å¾ªç¯ä¾èµ–ï¼Ÿ
```

#### ç¤ºä¾‹ï¼šå‘ç°å†²çªæ—¶çš„å¤„ç†

```
æ¶æ„å¸ˆå‘ç°ï¼š
  Spec 003 plan.md: ä½¿ç”¨ Redis åšç¼“å­˜
  Spec 017 plan.md: ä½¿ç”¨ Memcached åšç¼“å­˜

å¤„ç†æµç¨‹ï¼š
  1. æ¶æ„å¸ˆåœ¨ç¾¤é‡Œå‘èµ·è®¨è®º
  2. ç¡®å®šç»Ÿä¸€æ–¹æ¡ˆï¼ˆå¦‚é€‰æ‹© Redisï¼‰
  3. æ›´æ–° CLAUDE.md æ·»åŠ çº¦æŸï¼šç¼“å­˜ç»Ÿä¸€ä½¿ç”¨ Redis
  4. é€šçŸ¥ç›¸å…³å¼€å‘è€…æ›´æ–° plan.md
```

---

## 6. å®ç°é˜¶æ®µ

### /speckit.implement æµç¨‹

```bash
# 1. ç¡®ä¿ plan.md å·²å®¡æ ¸é€šè¿‡
# 2. ç”Ÿæˆä»»åŠ¡åˆ—è¡¨
/speckit.tasks

# 3. å¼€å§‹å®ç°
/speckit.implement
# AI ä¼šè¯»å– spec.md + plan.md + tasks.md
# æŒ‰ tasks.md é¡ºåºé€ä¸ªå®ç°

# 4. æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œæ ‡è®°ä¸º [x]
# 5. æäº¤ä»£ç 
git add .
git commit -m "feat(003): implement DocumentRepository"
```

### AI Prompt æ¨¡æ¿

```
æˆ‘æ­£åœ¨å®ç° specs/003-enterprise-knowledgeã€‚

è¯·å…ˆé˜…è¯»ï¼š
1. specs/003-enterprise-knowledge/spec.md - éœ€æ±‚
2. specs/003-enterprise-knowledge/plan.md - æˆ‘çš„æŠ€æœ¯æ–¹æ¡ˆ
3. specs/003-enterprise-knowledge/tasks.md - ä»»åŠ¡åˆ—è¡¨

å½“å‰ä»»åŠ¡ï¼š[å…·ä½“ä»»åŠ¡]

è¯·éµå¾ª plan.md ä¸­å®šä¹‰çš„æ¶æ„å’ŒæŠ€æœ¯å†³ç­–ã€‚
```

### åˆ†æ­¥å®ç°ï¼ˆé¿å…ä¸€æ¬¡æ€§ç”Ÿæˆå¤§é‡ä»£ç ï¼‰

```
âŒ é”™è¯¯ï¼šå¸®æˆ‘å®ç°æ•´ä¸ªçŸ¥è¯†åº“æ¨¡å—

âœ… æ­£ç¡®ï¼š
1. å…ˆå®ç° DocumentParser ç±»
2. [å®¡æŸ¥ä»£ç ]
3. å†å®ç° VectorStore ç±»
4. [å®¡æŸ¥ä»£ç ]
5. æœ€åå®ç° KnowledgeService
```

---

## 7. æ¯æ—¥åŒæ­¥æœºåˆ¶

### Daily Standupï¼ˆ15 åˆ†é’Ÿï¼‰

```
1. æˆ‘çš„ Spec è¿›åº¦å¦‚ä½•ï¼Ÿï¼ˆplan/tasks/implement å“ªä¸ªé˜¶æ®µï¼‰
2. æ˜¯å¦æœ‰è·¨ Spec ä¾èµ–éœ€è¦åè°ƒï¼Ÿ
3. æ˜¯å¦éœ€è¦æ¶æ„å¸ˆååŠ©å®¡æ ¸ plan.mdï¼Ÿ
4. æ˜¯å¦æœ‰é˜»å¡é—®é¢˜ï¼Ÿ
```

### è·¨ Spec ä¾èµ–åè°ƒ

```
å¼€å‘è€… B (Spec 003) å‘ç°ä¾èµ– å¼€å‘è€… C (Spec 017) çš„æ¥å£
       â†“
åœ¨ç¾¤é‡Œæå‡º @å¼€å‘è€…C
       â†“
å¼€å‘è€… C ä¼˜å…ˆå®šä¹‰æ¥å£ï¼ˆåœ¨ plan.md ä¸­ï¼‰
       â†“
æ¶æ„å¸ˆå®¡æ ¸æ¥å£
       â†“
å¼€å‘è€… B å¯ä»¥åŸºäºæ¥å£ç»§ç»­å¼€å‘ï¼ˆMock å®ç°ï¼‰
       â†“
å¼€å‘è€… C å®Œæˆå®é™…å®ç°åæ›¿æ¢ Mock
```

### Spec çŠ¶æ€çœ‹æ¿

| Spec | è´Ÿè´£äºº | Plan | Tasks | Implement | é˜»å¡ |
|------|--------|------|-------|-----------|------|
| 003 | å¼€å‘è€… B | âœ… | âœ… | ğŸ”„ 60% | - |
| 004 | å¼€å‘è€… C | âœ… | ğŸ”„ | - | ç­‰ 017 |
| 015 | å¼€å‘è€… A | âœ… | âœ… | ğŸ”„ 30% | - |
| 017 | å¼€å‘è€… C | ğŸ”„ | - | - | - |

---

## 8. ä»£ç è´¨é‡ä¿éšœ

### è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼ˆCIï¼‰

```yaml
# .github/workflows/quality.yml
name: Quality Gate
on: [push, pull_request]

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - name: Type Check
        run: uv run pyright

      - name: Lint
        run: uv run ruff check .

      - name: Test
        run: uv run pytest --cov=backend

      - name: Architecture Guard
        run: uv run pytest tests/architecture/ -v
```

### æ¶æ„å®ˆæŠ¤æµ‹è¯•

```python
# tests/architecture/test_dependencies.py
def test_agents_not_import_db_directly():
    """Agent ä¸èƒ½ç›´æ¥å¯¼å…¥æ•°æ®åº“æ¨¡å—"""
    for file in glob("backend/agents/*.py"):
        with open(file) as f:
            content = f.read()
        assert "import asyncpg" not in content
        assert "from backend.db" not in content
```

### Pre-commit Hooks

```yaml
# .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: typecheck
        name: Type Check
        entry: uv run pyright
        language: system
        types: [python]

      - id: lint
        name: Lint
        entry: uv run ruff check --fix
        language: system
        types: [python]
```

---

## 9. ä»£ç å®¡æŸ¥

### PR æ¨¡æ¿

```markdown
## å…³è” Spec
specs/003-xxx

## å®Œæˆçš„ä»»åŠ¡
- [x] 2.1 å®ç° DocumentRepository
- [x] 2.2 å®ç° KnowledgeService

## AI è¾…åŠ©æƒ…å†µ
- [ ] ä¸»è¦ç”± AI ç”Ÿæˆ
- [x] AI è¾…åŠ© + äººå·¥ä¿®æ”¹
- [ ] ä¸»è¦äººå·¥ç¼–å†™

## æ£€æŸ¥æ¸…å•
- [x] éµå¾ª plan.md ä¸­çš„æ¶æ„çº¦æŸ
- [x] æ·»åŠ äº†å•å…ƒæµ‹è¯•
- [x] ç±»å‹æ£€æŸ¥é€šè¿‡
- [ ] æ¥å£å˜æ›´å·²ç»è¿‡æ¶æ„è¯„å®¡ï¼ˆå¦‚æœ‰ï¼‰
```

### é‡ç‚¹å®¡æŸ¥é¡¹

| å®¡æŸ¥é¡¹ | è¯´æ˜ |
|--------|------|
| **ä¾èµ–æ–¹å‘** | Agent â†’ Service â†’ Repositoryï¼Œä¸èƒ½åå‘ |
| **æ¥å£ä¸€è‡´** | æ˜¯å¦ç¬¦åˆ contracts/ ä¸­çš„å®šä¹‰ |
| **é‡å¤ä»£ç ** | AI å®¹æ˜“ç”Ÿæˆé‡å¤ä»£ç ï¼Œæ£€æŸ¥æ˜¯å¦å¯å¤ç”¨ |
| **è¿‡åº¦å·¥ç¨‹** | AI å¯èƒ½æ·»åŠ ä¸å¿…è¦çš„æŠ½è±¡å±‚ |
| **ç¡¬ç¼–ç ** | æ£€æŸ¥é­”æ³•æ•°å­—ã€ç¡¬ç¼–ç å­—ç¬¦ä¸² |

---

## 10. ç›®å½•ç»“æ„è§„èŒƒ

```
backend/
â”œâ”€â”€ agents/                 # Agent å®ç°ï¼ˆæŒ‰å¼€å‘è€…åˆ†é…ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ supervisor.py       # å¼€å‘è€… A
â”‚   â”œâ”€â”€ knowledge_agent.py  # å¼€å‘è€… B
â”‚   â””â”€â”€ analysis_agent.py   # å¼€å‘è€… C
â”‚
â”œâ”€â”€ services/               # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ knowledge_service.py
â”‚   â””â”€â”€ datasource_service.py
â”‚
â”œâ”€â”€ repositories/           # æ•°æ®è®¿é—®å±‚
â”‚   â””â”€â”€ document_repository.py
â”‚
â”œâ”€â”€ contracts/              # æ¥å£å®šä¹‰ï¼ˆæ¶æ„å¸ˆç»´æŠ¤ï¼‰
â”‚   â”œâ”€â”€ knowledge.py
â”‚   â””â”€â”€ datasource.py
â”‚
â””â”€â”€ shared/                 # å…±äº«å·¥å…·ï¼ˆè°¨æ…ä¿®æ”¹ï¼‰
    â”œâ”€â”€ exceptions.py
    â”œâ”€â”€ models.py
    â””â”€â”€ utils.py
```

---

## 11. å¸¸è§é—®é¢˜

### Q1ï¼šAI ç”Ÿæˆäº†é‡å¤çš„å·¥å…·å‡½æ•°

**è§£å†³**ï¼š
- å»ºç«‹ `shared/utils.py` ä½œä¸ºå·¥å…·å‡½æ•°ç»Ÿä¸€å…¥å£
- åœ¨ plan.md ä¸­åˆ—å‡ºå·²æœ‰å·¥å…·å‡½æ•°
- PR å®¡æŸ¥æ—¶æ£€æŸ¥æ˜¯å¦é‡å¤

### Q2ï¼šAI ç”Ÿæˆçš„ä»£ç ç»•è¿‡äº†æ¶æ„çº¦æŸ

**è§£å†³**ï¼š
- æ¶æ„å®ˆæŠ¤æµ‹è¯•è‡ªåŠ¨æ£€æµ‹
- åœ¨ AI prompt ä¸­æ˜ç¡®æåŠæ¶æ„çº¦æŸ
- Code Review é‡ç‚¹æ£€æŸ¥ä¾èµ–æ–¹å‘

### Q3ï¼šæ¥å£å®šä¹‰å†²çª

**è§£å†³**ï¼š
- æ¯å¤©å¼€å§‹å‰ `git pull` æœ€æ–° contracts
- æ¥å£å˜æ›´å¿…é¡»å‘ç¾¤é€šçŸ¥
- ä½¿ç”¨ Feature Flag æ¸è¿›å¼åˆ‡æ¢

### Q4ï¼šå¤šäººä¿®æ”¹åŒä¸€æ–‡ä»¶

**è§£å†³**ï¼š
- åœ¨ plan.md ä¸­æ˜ç¡®æ–‡ä»¶æ‰€æœ‰æƒ
- å…±äº«æ–‡ä»¶ï¼ˆshared/, contracts/ï¼‰ä¿®æ”¹å‰å…ˆæ²Ÿé€š
- å°æ­¥æäº¤ï¼Œé¿å…å¤§èŒƒå›´å†²çª

---

## 12. æ£€æŸ¥æ¸…å•

### æ¥åˆ° Spec å

- [ ] åˆ‡æ¢åˆ°åˆ†é…çš„ Spec åˆ†æ”¯ (`git checkout {spec-branch}`)
- [ ] é˜…è¯» spec.md ç†è§£éœ€æ±‚
- [ ] è¿è¡Œ `/speckit.plan` ç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆ
- [ ] æ£€æŸ¥ä¸å…¶ä»– Spec çš„ä¾èµ–å…³ç³»
- [ ] æäº¤ plan.md å¹¶é€šçŸ¥æ¶æ„å¸ˆå®¡æ ¸

### plan.md å®¡æ ¸é€šè¿‡å

- [ ] è¿è¡Œ `/speckit.tasks` ç”Ÿæˆä»»åŠ¡åˆ—è¡¨
- [ ] è¿è¡Œ `/speckit.implement` å¼€å§‹å®ç°
- [ ] æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡æ ‡è®° [x]

### ä½¿ç”¨ AI ç”Ÿæˆä»£ç æ—¶

- [ ] æä¾›äº† spec.md + plan.md ä¸Šä¸‹æ–‡
- [ ] æ˜ç¡®äº†å½“å‰ä»»åŠ¡
- [ ] åˆ†æ­¥éª¤ç”Ÿæˆï¼Œæ¯æ­¥å®¡æŸ¥

### æäº¤ä»£ç å‰

- [ ] æœ¬åœ°ç±»å‹æ£€æŸ¥é€šè¿‡ (`uv run pyright`)
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡ (`uv run pytest`)
- [ ] æ›´æ–° tasks.md çŠ¶æ€
- [ ] å¡«å†™ PR æ¨¡æ¿

### Spec å®Œæˆå

- [ ] æ‰€æœ‰ tasks.md ä»»åŠ¡æ ‡è®°ä¸º [x]
- [ ] è¿è¡Œ `/speckit.analyze` æ£€æŸ¥ä¸€è‡´æ€§
- [ ] åˆ›å»º PR åˆå¹¶åˆ° main (`gh pr create --base main`)
- [ ] é€šçŸ¥æ¶æ„å¸ˆ/PM è¯¥ Spec å·²å®Œæˆ
